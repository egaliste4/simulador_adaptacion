<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Adaptación - Licenciatura a Grado en Filosofía</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f2f5 0%, #e0e5ec 100%); /* Lighter background */
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px; /* Softer radius */
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); /* Softer shadow */
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4A00E0 0%, #8E2DE2 100%); /* UCM-like purple gradient */
            color: white;
            padding: 25px 30px; /* Adjusted padding */
            text-align: center;
        }

        .header h1 {
            font-size: 2.2rem; /* Adjusted size */
            margin-bottom: 8px;
            font-weight: 400; /* Lighter font weight */
        }

        .header p {
            font-size: 1rem;
            opacity: 0.85;
        }

        .content {
            padding: 30px; /* Adjusted padding */
        }

        .search-section {
            margin-bottom: 30px;
        }

        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 18px; /* Adjusted padding */
            border: 1px solid #ced4da; /* Standard border */
            border-radius: 8px; /* Softer radius */
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .search-input:focus {
            outline: none;
            border-color: #8E2DE2; /* UCM-like purple */
            background: white;
            box-shadow: 0 0 0 2px rgba(142, 45, 226, 0.2); /* Focus shadow */
        }

        .subject-list {
            background: #f8f9fa;
            border-radius: 8px;
            max-height: 280px; /* Adjusted height */
            overflow-y: auto;
            border: 1px solid #ced4da;
        }

        .subject-item {
            padding: 12px 18px;
            cursor: pointer;
            border-bottom: 1px solid #e9ecef; /* Lighter border */
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .subject-item.selected-for-adaptation {
            background-color: #e6f7ff; /* Light blue for already selected */
            color: #005285;
        }
        .subject-item.selected-for-adaptation:hover {
            background-color: #d0f0ff;
        }


        .subject-item:hover {
            background: #e9f5ff; /* Light blue hover */
        }

        .subject-item:last-child {
            border-bottom: none;
        }

        .subject-name {
            font-weight: 500;
            color: #212529; /* Darker text */
        }

        .subject-code {
            font-size: 0.85rem; /* Adjusted size */
            color: #6c757d; /* Greyer text */
            background: #e9ecef;
            padding: 3px 7px; /* Adjusted padding */
            border-radius: 4px;
        }

        .results-section {
            /* display: none; initially handled by JS now */
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); /* Blue gradient */
            color: white;
            padding: 18px 25px; /* Adjusted padding */
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
        }

        .results-header h2 {
            font-size: 1.6rem; /* Adjusted size */
            margin-bottom: 8px;
        }

        .selected-subject-display {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        #clear-selected-button {
            background: #dc3545; /* Red for clear */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
            margin-top: 15px;
            display: block; /* Make it block to center with margin auto or align */
            margin-left: auto;
            margin-right: auto;
        }
        #clear-selected-button:hover {
            background-color: #c82333;
        }


        .equivalences-container { /* New container for multiple equivalences */
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            background-color: #f8f9fa;
        }

        .licenciatura-block {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #adb5bd;
        }
        .licenciatura-block:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .licenciatura-block h3 {
            font-size: 1.2rem;
            color: #4A00E0; /* UCM-like purple */
            margin-bottom: 12px;
        }


        .equivalence-card {
            background: white;
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
            margin-bottom: 15px; /* Space between cards if multiple for one Lic. subject */
        }
         .equivalence-card:last-child {
            margin-bottom: 0;
        }

        .equivalence-type {
            font-size: 0.85rem;
            color: #fff;
            background-color: #007bff; /* Blue */
            padding: 4px 9px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .equivalence-content h4 { /* Changed from h3 */
            color: #343a40; /* Darker text */
            font-size: 1.1rem; /* Adjusted size */
            margin-bottom: 8px;
        }

        .equivalence-details {
            display: flex;
            gap: 10px; /* Adjusted gap */
            flex-wrap: wrap;
            align-items: center;
        }

        .code-badge, .character-badge {
            padding: 5px 10px; /* Adjusted padding */
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
            color: white;
        }
        .code-badge { background: #17a2b8; } /* Teal */
        .character-badge { background: #28a745; } /* Green */


        .no-results, .no-selected-subjects { /* Added new class */
            text-align: center;
            padding: 30px;
            color: #6c757d;
            font-size: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ced4da;
        }

        .summary-section {
            background: #e9ecef; /* Lighter grey */
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            border-left: 3px solid #4A00E0; /* UCM-like purple */
        }

        .summary-section h3 {
            color: #212529;
            margin-bottom: 12px;
            font-size: 1.2rem;
        }

        .summary-text {
            color: #495057; /* Darker grey */
            line-height: 1.6;
        }
        .summary-text ul {
            list-style-position: inside;
            padding-left: 0;
        }
        .summary-text li {
            margin-bottom: 4px;
        }


        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            .content {
                padding: 15px;
            }
            .equivalence-details {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Simulador de Adaptación</h1>
            <p>De Licenciatura a Grado en Filosofía - UCM</p>
        </div>

        <div class="content">
            <div id="search-section" class="search-section">
                <div class="search-container">
                    <input type="text" id="search-input" class="search-input" 
                           placeholder="Busca y selecciona asignaturas de Licenciatura...">
                </div>
                <div id="subject-list" class="subject-list">
                    <!-- Las asignaturas de Licenciatura se listarán aquí -->
                </div>
            </div>

            <div id="results-section" class="results-section" style="display: none;">
                <div class="results-header">
                    <h2>Asignaturas de Grado Reconocidas</h2>
                    <!-- Ya no mostramos un "selected-subject" único aquí -->
                </div>
                <div id="equivalences-container" class="equivalences-container">
                    <!-- Los bloques de equivalencias se mostrarán aquí -->
                </div>
                <div id="no-selected-subjects" class="no-selected-subjects" style="display: none;">
                    <p>No has seleccionado ninguna asignatura de Licenciatura para ver sus equivalencias.</p>
                    <p>Busca y haz clic en las asignaturas de la lista de arriba para añadirlas.</p>
                </div>

                <button id="clear-selected-button">Limpiar Selección y Resultados</button>

                <div class="summary-section">
                    <h3>📚 Resumen General de tu Adaptación</h3>
                    <div id="summary-text" class="summary-text">
                        <p>Selecciona asignaturas de Licenciatura para ver el resumen de las asignaturas de Grado que se te reconocerían.</p>
                    </div>
                </div>
            </div>

            <div id="no-results" class="no-results" style="display: none;">
                <p>No se encontraron asignaturas de Licenciatura con ese nombre/código.</p>
                <p>Intenta con otro término de búsqueda o revisa la escritura.</p>
            </div>
        </div>
    </div>

    <script>
        // --- DATOS DE ADAPTACIÓN ---
        const adaptationData = [
            // ... (TU ARRAY adaptationData COMPLETO VA AQUÍ, NO LO ABREVIO)
            // Corregir nombres según tu petición:
            {
                licenciatura: { codigo: "104438", nombre: "ANTROPOLOGÍA", caracter: "TR. 1º" },
                grado: [ { codigo: "801292", nombre: "ANTROPOLOGÍA I", caracter: "BÁS. 1º" }, { codigo: "801297", nombre: "ANTROPOLOGÍA II", caracter: "BÁS. 1º" }]
            },
            {
                licenciatura: { codigo: "104439", nombre: "HISTORIA FILOSOFÍA ANTIGUA", caracter: "TR. 1º" },
                grado: [ { codigo: "801298", nombre: "HISTORIA FILOSOFÍA ANTIGUA", caracter: "OB. 1º" }, { codigo: "801319", nombre: "SEM. HISTORIA FILOSOFÍA ANTIGUA", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104440", nombre: "LÓGICA", caracter: "TR. 1º" },
                grado: [ { codigo: "801304", nombre: "LÓGICA I", caracter: "OB. 2º" }, { codigo: "801309", nombre: "LÓGICA II", caracter: "OB. 2º" }]
            },
            {
                licenciatura: { codigo: "104441", nombre: "ONTOLOGÍA", caracter: "OB. 1º" },
                grado: [ { codigo: "801293", nombre: "ONTOLOGÍA FUNDAMENTAL", caracter: "BÁS. 1º" }, { codigo: "801313", nombre: "HERMENÉUTICA Y LENGUA", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104442", nombre: "ALEMÁN I", caracter: "OB. 1º" },
                grado: [ { codigo: "801305", nombre: "ALEMÁN BÁSICO PARA FILÓSOFOS", caracter: "BÁS. 2º" }, { codigo: "801294", nombre: "LITERATURA CONTEMPORÁNEA", caracter: "BÁS. 1º" }]
            },
            {
                licenciatura: { codigo: "104443", nombre: "LATÍN I", caracter: "OB. 1º" },
                grado: [ { codigo: "801305", nombre: "ALEMÁN BÁSICO PARA FILÓSOFOS", caracter: "BÁS. 2º" }, { codigo: "801300", nombre: "HISTORIA DEL MUNDO CONTEMPORÁNEO", caracter: "BÁS. 2º" }]
            },
            {
                licenciatura: { codigo: "104444", nombre: "GRIEGO I", caracter: "OB. 1º" },
                grado: [ { codigo: "801305", nombre: "ALEMÁN BÁSICO PARA FILÓSOFOS", caracter: "BÁS. 2º" }, { codigo: "801290", nombre: "HISTORIA DEL MUNDO CONTEMPORÁNEO", caracter: "BÁS. 2º" }]
            },
            {
                licenciatura: { codigo: "104445", nombre: "HISTORIA FILOSOFÍA MEDIEVAL", caracter: "TR. 1º" },
                grado: [ { codigo: "801299", nombre: "HISTORIA FILOSOFÍA MEDIEVAL", caracter: "OB. 1º" }, { codigo: "801320", nombre: "SEM. HISTORIA FILOSOFÍA MEDIEVAL", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104446", nombre: "FILOSOFÍA DEL LENGUAJE", caracter: "TR. 2º" },
                grado: [ { codigo: "801334", nombre: "FILOSOFÍA DEL LENGUAJE I", caracter: "OB. 3º" }, { codigo: "801343", nombre: "FILOSOFÍA DEL LENGUAJE II", caracter: "OB. 3º" }]
            },
            {
                licenciatura: { codigo: "104450", nombre: "FILOSOFÍA NATURALEZA", caracter: "OB. 2º" },
                grado: [ { codigo: "801303", nombre: "FILOSOFÍA NATURALEZA", caracter: "OB. 2º" }]
            },
            {
                licenciatura: { codigo: "104447", nombre: "ALEMÁN II", caracter: "OB. 2º" },
                grado: [ { codigo: "801337", nombre: "ALEMÁN AVANZ. FILÓSOFOS", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104448", nombre: "LATÍN II", caracter: "OB. 2º" },
                grado: [ { codigo: "801338", nombre: "LATÍN PARA FILÓSOFOS", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104449", nombre: "GRIEGOII", caracter: "OB. 2º" },
                grado: [ { codigo: "801339", nombre: "GRIEGO PARA FILÓSOFOS", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104451", nombre: "TEORÍA RACIONALIDAD PRÁCTICA", caracter: "OB. 2º" },
                grado: [ { codigo: "801339G", nombre: "TEORÍA RACIONALIDAD PRÁCTICA", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104452", nombre: "INTRODUCCIÓN PSICOLOGÍA", caracter: "OB. 2º" },
                grado: [ { codigo: "801295", nombre: "PSICOLOGÍA BÁSICA", caracter: "BÁS. 1º" }]
            },
            {
                licenciatura: { codigo: "104453", nombre: "HISTORIA FILOSOFÍA MODERNA", caracter: "TR. 3º" },
                grado: [ { codigo: "801307", nombre: "HISTORIA FILOSOFÍA MODERNA", caracter: "OB. 2º" }, { codigo: "801321", nombre: "HISTORIA FILOSOFÍA MODERNA II", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104454", nombre: "ÉTICA", caracter: "TR. 3º" },
                grado: [ { codigo: "801301", nombre: "ÉTICA I", caracter: "BÁS. 2º" }, { codigo: "801308", nombre: "ÉTICA II", caracter: "OB. 2º" }]
            },
            {
                licenciatura: { codigo: "104455", nombre: "TEORÍA DEL CONOCIMIENTO", caracter: "TR. 3º" }, // <-- NOMBRE CORREGIDO
                grado: [ { codigo: "801302", nombre: "TEORÍA CONOCIMIENTO I", caracter: "OB. 2º" }, { codigo: "801306", nombre: "TEORÍA CONOCIMIENTO II", caracter: "OB. 2º" }]
            },
            {
                licenciatura: { codigo: "104456", nombre: "HISTORIA Y FILOSOFÍA DE LA LÓGICA", caracter: "OB. 3º" },
                grado: [ { codigo: "801313F", nombre: "FILOSOFÍA DE LA LÓGICA", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104457", nombre: "FILOSOFÍA RELIGIÓN", caracter: "OB. 3" },
                grado: [ { codigo: "801315F", nombre: "FILOSOFÍA DE LA RELIGIÓN", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104479", nombre: "METAFÍSICA", caracter: "TR. 4º" },
                grado: [ { codigo: "801312", nombre: "METAFÍSICA I", caracter: "OB. 3º" }, { codigo: "801340", nombre: "METAFÍSICA II", caracter: "OB. 3º" }]
            },
            {
                licenciatura: { codigo: "104480", nombre: "ESTÉTICA", caracter: "TR. 4º" },
                grado: [ { codigo: "801296E", nombre: "ESTÉTICA", caracter: "BÁS. 1º" }, { codigo: "801329", nombre: "PERSP. ESTÉTICA CONTEMPORÁ.", caracter: "OB. 3º" }]
            },
            {
                licenciatura: { codigo: "104481", nombre: "FILOSOFÍA CONTEMPORÁ.", caracter: "OB. 4º" },
                grado: [ { codigo: "801323S", nombre: "SEM. FILOSOFÍA CONTEMPOR.", caracter: "OPT. 3º ó 4º" }, { codigo: "801322", nombre: "FILOSOFÍA SIGLO XIX", caracter: "OB. 3º" }]
            },
            {
                licenciatura: { codigo: "104482", nombre: "HISTORIA FILOSOFÍA ESPAÑOLA", caracter: "OB. 4º" },
                grado: [ { codigo: "801341F", nombre: "FILOSOFÍA ESPAÑOLA CONTEMP.", caracter: "OB. 3º" }]
            },
            {
                licenciatura: { codigo: "104483", nombre: "HISTORIA TEORÍA CIENCIA", caracter: "OB. 4º" },
                grado: [ { codigo: "801336H", nombre: "HISTORIA DE LA CIENCIA", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104484", nombre: "TEORÍA Y SOCIEDAD", caracter: "OB. 4º" },
                grado: [ { codigo: "801328T", nombre: "TEORÍA DE LA SOCIEDAD", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104485", nombre: "ESCUELAS Y SISTEMAS DE PSICOLOGÍA", caracter: "OB. 4º" }, // <-- NOMBRE CORREGIDO
                grado: [ { codigo: "801344F", nombre: "FILOSOFÍA DE LA MENTE", caracter: "OB. 4º" }]
            },
            {
                licenciatura: { codigo: "104486", nombre: "FILOSOFÍA CIENCIA", caracter: "TR. 5º" },
                grado: [ { codigo: "801346", nombre: "FILOSOFÍA DE LA CIENCIA I", caracter: "OB. 4º" }, { codigo: "801348", nombre: "FILOSOFÍA DE LA CIENCIA II", caracter: "OB. 4º" }]
            },
            {
                licenciatura: { codigo: "104487", nombre: "FILOSOFÍA POLÍTICA", caracter: "TR. 5º" },
                grado: [ { codigo: "801291", nombre: "FILOSOFÍA POLÍTICA I", caracter: "BÁS. 1º" }, { codigo: "801342", nombre: "FILOSOFÍA POLÍTICA II", caracter: "OB. 3º" }]
            },
            {
                licenciatura: { codigo: "104488", nombre: "CORRIENTES ACTUALES DE LA FILOSOFÍA I", caracter: "TR. 5º" },
                grado: [ { codigo: "801345C", nombre: "CORRIENTES ACTUALES FILOSOFÍA I", caracter: "OB. 4º" }]
            },
            {
                licenciatura: { codigo: "104489", nombre: "CORRIENTES ACTUALES DE LA FILOSOFÍA II", caracter: "TR. 5º" },
                grado: [ { codigo: "801347C", nombre: "CORRIENTES ACTUALES FILOSOFÍA II", caracter: "OB. 4º" }]
            },
            {
                licenciatura: { codigo: "104490", nombre: "FILOSOFÍA DE LA ACCIÓN", caracter: "TR. 5º" },
                grado: [ { codigo: "801310F", nombre: "FILOSOFÍA DE LA ACCIÓN", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104491", nombre: "FILOSOFÍA DE LA HISTORIA", caracter: "OB. 5º" },
                grado: [ { codigo: "801318F", nombre: "FILOSOFÍA DE LA HISTORIA", caracter: "OPT. 3º ó 4º" }]
            },
            {
                licenciatura: { codigo: "104498", nombre: "TEORÍAS DE LA LIBERTAD", caracter: "2º" },
                grado: [ { codigo: "801314", nombre: "TEORÍAS DE LA LIBERTAD", caracter: "" }]
            },
            {
                licenciatura: { codigo: "U 07", nombre: "CIENCIA, TECNOLOGÍA Y SOCIEDAD", caracter: "GENÉRICA" },
                grado: [ { codigo: "801327C", nombre: "CIENCIA, TECNOLOGÍA Y SOCIEDAD", caracter: "" }]
            },
            {
                licenciatura: { codigo: "104469F", nombre: "TEORÍA Y CRÍTICA FEMINISTA", caracter: "1º" },
                grado: [ { codigo: "801332", nombre: "TEORÍA Y CRÍTICA FEMINISTA", caracter: "" }]
            }
        ];

        // --- VARIABLES DE ESTADO Y ELEMENTOS DOM ---
        let filteredLicenciaturaSubjects = [...adaptationData];
        let selectedLicenciaturaCodes = []; // Almacena los códigos de las asignaturas de Lic. seleccionadas

        const searchInput = document.getElementById('search-input');
        const subjectListEl = document.getElementById('subject-list');
        const resultsSectionEl = document.getElementById('results-section');
        const equivalencesContainerEl = document.getElementById('equivalences-container');
        const noSelectedSubjectsEl = document.getElementById('no-selected-subjects');
        const summaryTextEl = document.getElementById('summary-text');
        const noResultsEl = document.getElementById('no-results');
        const clearSelectedButton = document.getElementById('clear-selected-button');

        // --- FUNCIONES AUXILIARES ---
        function normalizeText(text) {
            if (!text) return "";
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        }

        // --- LÓGICA DE RENDERIZADO ---
        function renderLicenciaturaSubjectList() {
            if (!subjectListEl) return;

            if (filteredLicenciaturaSubjects.length === 0 && searchInput.value.trim() !== "") {
                subjectListEl.style.display = 'none';
                noResultsEl.style.display = 'block';
                return;
            }

            noResultsEl.style.display = 'none';
            subjectListEl.style.display = 'block';
            subjectListEl.innerHTML = filteredLicenciaturaSubjects.map(item => {
                const isSelected = selectedLicenciaturaCodes.includes(item.licenciatura.codigo);
                return `
                <div class="subject-item ${isSelected ? 'selected-for-adaptation' : ''}" 
                     onclick="toggleLicenciaturaSelection('${item.licenciatura.codigo}')"
                     data-codigo="${item.licenciatura.codigo}">
                    <span class="subject-name">${item.licenciatura.nombre}</span>
                    <span class="subject-code">Cód: ${item.licenciatura.codigo} (${item.licenciatura.caracter})</span>
                </div>
            `}).join('');
        }

        function renderResults() {
            if (!equivalencesContainerEl || !summaryTextEl || !resultsSectionEl || !noSelectedSubjectsEl) return;

            if (selectedLicenciaturaCodes.length === 0) {
                resultsSectionEl.style.display = 'none'; // Ocultar toda la sección de resultados
                return;
            }
            
            resultsSectionEl.style.display = 'block'; // Mostrar la sección de resultados
            equivalencesContainerEl.innerHTML = ''; // Limpiar resultados anteriores
            let allGradoEquivalents = [];

            if (selectedLicenciaturaCodes.length > 0) {
                noSelectedSubjectsEl.style.display = 'none';
                selectedLicenciaturaCodes.forEach(codigoLic => {
                    const subjectData = adaptationData.find(item => item.licenciatura.codigo === codigoLic);
                    if (subjectData) {
                        const block = document.createElement('div');
                        block.className = 'licenciatura-block';
                        block.innerHTML = `<h3>${subjectData.licenciatura.nombre} (Licenciatura) equivale a:</h3>`;
                        
                        subjectData.grado.forEach((gradoItem, index) => {
                            block.innerHTML += `
                                <div class="equivalence-card">
                                    <div class="equivalence-type">Equivalencia en Grado ${subjectData.grado.length > 1 ? (index + 1) : ''}</div>
                                    <div class="equivalence-content">
                                        <h4>${gradoItem.nombre || 'Nombre no disponible'}</h4>
                                        <div class="equivalence-details">
                                            <span class="code-badge">Cód: ${gradoItem.codigo || 'N/A'}</span>
                                            <span class="character-badge">${gradoItem.caracter || 'Carácter no especificado'}</span>
                                        </div>
                                    </div>
                                </div>`;
                            allGradoEquivalents.push(gradoItem);
                        });
                        equivalencesContainerEl.appendChild(block);
                    }
                });
            } else {
                noSelectedSubjectsEl.style.display = 'block';
            }


            // Renderizar resumen general
            if (allGradoEquivalents.length > 0) {
                // Evitar duplicados en el resumen general
                const uniqueGradoEquivalents = allGradoEquivalents.filter((grado, index, self) =>
                    index === self.findIndex((g) => (
                        g.codigo === grado.codigo
                    ))
                );

                let summary = `<p>Con las asignaturas de Licenciatura seleccionadas, se te reconocerían las siguientes asignaturas del nuevo Grado en Filosofía:</p><ul>`;
                uniqueGradoEquivalents.forEach(g => {
                    summary += `<li><strong>${g.nombre || 'Asignatura sin nombre especificado'}</strong> (Cód: ${g.codigo || 'N/A'}, ${g.caracter || 'Carácter no especificado'})</li>`;
                });
                summary += `</ul><p>Este es el conjunto total de asignaturas de Grado que tendrías aprobadas.</p>`;
                summaryTextEl.innerHTML = summary;
            } else {
                summaryTextEl.innerHTML = `<p>Aún no has seleccionado asignaturas de Licenciatura o las seleccionadas no tienen equivalencias directas definidas.</p>`;
            }
        }


        // --- MANEJADORES DE EVENTOS Y LÓGICA DE INTERACCIÓN ---
        function filterLicenciaturaSubjects(searchTerm) {
            const normalizedSearchTerm = normalizeText(searchTerm);
            if (!normalizedSearchTerm.trim()) {
                filteredLicenciaturaSubjects = [...adaptationData];
            } else {
                filteredLicenciaturaSubjects = adaptationData.filter(item =>
                    normalizeText(item.licenciatura.nombre).includes(normalizedSearchTerm) ||
                    item.licenciatura.codigo.toString().toLowerCase().includes(normalizedSearchTerm) // Código no suele tener acentos
                );
            }
            renderLicenciaturaSubjectList();
        }

        function toggleLicenciaturaSelection(codigoLic) {
            const index = selectedLicenciaturaCodes.indexOf(codigoLic);
            if (index > -1) {
                selectedLicenciaturaCodes.splice(index, 1); // Deseleccionar
            } else {
                selectedLicenciaturaCodes.push(codigoLic); // Seleccionar
            }
            
            // Actualizar visualmente el item en la lista de búsqueda
            const listItem = subjectListEl.querySelector(`.subject-item[data-codigo="${codigoLic}"]`);
            if(listItem) {
                listItem.classList.toggle('selected-for-adaptation');
            }

            renderResults(); // Actualizar la sección de resultados
        }
        
        function clearAllSelections() {
            selectedLicenciaturaCodes = [];
            searchInput.value = ''; // Limpiar campo de búsqueda
            filterLicenciaturaSubjects(''); // Mostrar todas las asignaturas de licenciatura de nuevo
            renderResults(); // Esto ocultará la sección de resultados porque no hay nada seleccionado
        }


        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            if (searchInput) {
                searchInput.addEventListener('input', (e) => filterLicenciaturaSubjects(e.target.value));
            }
            if (clearSelectedButton) {
                clearSelectedButton.addEventListener('click', clearAllSelections);
            }

            // Corregir nombres en adaptationData ANTES del primer renderizado
            adaptationData.forEach(item => {
                if (item.licenciatura.codigo === "104455") item.licenciatura.nombre = "TEORÍA DEL CONOCIMIENTO";
                if (item.licenciatura.codigo === "104485") item.licenciatura.nombre = "ESCUELAS Y SISTEMAS DE PSICOLOGÍA";
            });
            
            filteredLicenciaturaSubjects = [...adaptationData]; // Asegurar que filteredData se inicializa con los nombres corregidos
            renderLicenciaturaSubjectList(); // Renderizar lista inicial de asignaturas de Lic.
            renderResults(); // Renderizar (ocultar) sección de resultados inicial
        });

    </script>
</body>
</html>