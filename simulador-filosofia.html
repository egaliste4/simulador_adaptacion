<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Adaptaci칩n - Licenciatura a Grado en Filosof칤a</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f2f5 0%, #e0e5ec 100%); /* Lighter background */
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px; /* Softer radius */
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); /* Softer shadow */
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4A00E0 0%, #8E2DE2 100%); /* UCM-like purple gradient */
            color: white;
            padding: 25px 30px; /* Adjusted padding */
            text-align: center;
        }

        .header h1 {
            font-size: 2.2rem; /* Adjusted size */
            margin-bottom: 8px;
            font-weight: 400; /* Lighter font weight */
        }

        .header p {
            font-size: 1rem;
            opacity: 0.85;
        }

        .content {
            padding: 30px; /* Adjusted padding */
        }

        .search-section {
            margin-bottom: 30px;
        }

        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 18px; /* Adjusted padding */
            border: 1px solid #ced4da; /* Standard border */
            border-radius: 8px; /* Softer radius */
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .search-input:focus {
            outline: none;
            border-color: #8E2DE2; /* UCM-like purple */
            background: white;
            box-shadow: 0 0 0 2px rgba(142, 45, 226, 0.2); /* Focus shadow */
        }

        .subject-list {
            background: #f8f9fa;
            border-radius: 8px;
            max-height: 280px; /* Adjusted height */
            overflow-y: auto;
            border: 1px solid #ced4da;
        }

        .subject-item {
            padding: 12px 18px;
            cursor: pointer;
            border-bottom: 1px solid #e9ecef; /* Lighter border */
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .subject-item.selected-for-adaptation {
            background-color: #e6f7ff; /* Light blue for already selected */
            color: #005285;
        }
        .subject-item.selected-for-adaptation:hover {
            background-color: #d0f0ff;
        }


        .subject-item:hover {
            background: #e9f5ff; /* Light blue hover */
        }

        .subject-item:last-child {
            border-bottom: none;
        }

        .subject-name {
            font-weight: 500;
            color: #212529; /* Darker text */
        }

        .subject-code {
            font-size: 0.85rem; /* Adjusted size */
            color: #6c757d; /* Greyer text */
            background: #e9ecef;
            padding: 3px 7px; /* Adjusted padding */
            border-radius: 4px;
        }

        .results-section {
            /* display: none; initially handled by JS now */
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); /* Blue gradient */
            color: white;
            padding: 18px 25px; /* Adjusted padding */
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
        }

        .results-header h2 {
            font-size: 1.6rem; /* Adjusted size */
            margin-bottom: 8px;
        }

        .selected-subject-display {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        #clear-selected-button {
            background: #dc3545; /* Red for clear */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
            margin-top: 15px;
            display: block; /* Make it block to center with margin auto or align */
            margin-left: auto;
            margin-right: auto;
        }
        #clear-selected-button:hover {
            background-color: #c82333;
        }


        .equivalences-container { /* New container for multiple equivalences */
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            background-color: #f8f9fa;
        }

        .licenciatura-block {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #adb5bd;
        }
        .licenciatura-block:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .licenciatura-block h3 {
            font-size: 1.2rem;
            color: #4A00E0; /* UCM-like purple */
            margin-bottom: 12px;
        }


        .equivalence-card {
            background: white;
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
            margin-bottom: 15px; /* Space between cards if multiple for one Lic. subject */
        }
         .equivalence-card:last-child {
            margin-bottom: 0;
        }

        .equivalence-type {
            font-size: 0.85rem;
            color: #fff;
            background-color: #007bff; /* Blue */
            padding: 4px 9px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .equivalence-content h4 { /* Changed from h3 */
            color: #343a40; /* Darker text */
            font-size: 1.1rem; /* Adjusted size */
            margin-bottom: 8px;
        }

        .equivalence-details {
            display: flex;
            gap: 10px; /* Adjusted gap */
            flex-wrap: wrap;
            align-items: center;
        }

        .code-badge, .character-badge {
            padding: 5px 10px; /* Adjusted padding */
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
            color: white;
        }
        .code-badge { background: #17a2b8; } /* Teal */
        .character-badge { background: #28a745; } /* Green */


        .no-results, .no-selected-subjects { /* Added new class */
            text-align: center;
            padding: 30px;
            color: #6c757d;
            font-size: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ced4da;
        }

        .summary-section {
            background: #e9ecef; /* Lighter grey */
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            border-left: 3px solid #4A00E0; /* UCM-like purple */
        }

        .summary-section h3 {
            color: #212529;
            margin-bottom: 12px;
            font-size: 1.2rem;
        }

        .summary-text {
            color: #495057; /* Darker grey */
            line-height: 1.6;
        }
        .summary-text ul {
            list-style-position: inside;
            padding-left: 0;
        }
        .summary-text li {
            margin-bottom: 4px;
        }


        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            .content {
                padding: 15px;
            }
            .equivalence-details {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Simulador de Adaptaci칩n</h1>
            <p>De Licenciatura a Grado en Filosof칤a - UCM</p>
        </div>

        <div class="content">
            <div id="search-section" class="search-section">
                <div class="search-container">
                    <input type="text" id="search-input" class="search-input" 
                           placeholder="Busca y selecciona asignaturas de Licenciatura...">
                </div>
                <div id="subject-list" class="subject-list">
                    <!-- Las asignaturas de Licenciatura se listar치n aqu칤 -->
                </div>
            </div>

            <div id="results-section" class="results-section" style="display: none;">
                <div class="results-header">
                    <h2>Asignaturas de Grado Reconocidas</h2>
                    <!-- Ya no mostramos un "selected-subject" 칰nico aqu칤 -->
                </div>
                <div id="equivalences-container" class="equivalences-container">
                    <!-- Los bloques de equivalencias se mostrar치n aqu칤 -->
                </div>
                <div id="no-selected-subjects" class="no-selected-subjects" style="display: none;">
                    <p>No has seleccionado ninguna asignatura de Licenciatura para ver sus equivalencias.</p>
                    <p>Busca y haz clic en las asignaturas de la lista de arriba para a침adirlas.</p>
                </div>

                <button id="clear-selected-button">Limpiar Selecci칩n y Resultados</button>

                <div class="summary-section">
                    <h3>游닄 Resumen General de tu Adaptaci칩n</h3>
                    <div id="summary-text" class="summary-text">
                        <p>Selecciona asignaturas de Licenciatura para ver el resumen de las asignaturas de Grado que se te reconocer칤an.</p>
                    </div>
                </div>
            </div>

            <div id="no-results" class="no-results" style="display: none;">
                <p>No se encontraron asignaturas de Licenciatura con ese nombre/c칩digo.</p>
                <p>Intenta con otro t칠rmino de b칰squeda o revisa la escritura.</p>
            </div>
        </div>
    </div>

    <script>
        // --- DATOS DE ADAPTACI칍N ---
        const adaptationData = [
            // ... (TU ARRAY adaptationData COMPLETO VA AQU칈, NO LO ABREVIO)
            // Corregir nombres seg칰n tu petici칩n:
            {
                licenciatura: { codigo: "104438", nombre: "ANTROPOLOG칈A", caracter: "TR. 1췈" },
                grado: [ { codigo: "801292", nombre: "ANTROPOLOG칈A I", caracter: "B츼S. 1췈" }, { codigo: "801297", nombre: "ANTROPOLOG칈A II", caracter: "B츼S. 1췈" }]
            },
            {
                licenciatura: { codigo: "104439", nombre: "HISTORIA FILOSOF칈A ANTIGUA", caracter: "TR. 1췈" },
                grado: [ { codigo: "801298", nombre: "HISTORIA FILOSOF칈A ANTIGUA", caracter: "OB. 1췈" }, { codigo: "801319", nombre: "SEM. HISTORIA FILOSOF칈A ANTIGUA", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104440", nombre: "L칍GICA", caracter: "TR. 1췈" },
                grado: [ { codigo: "801304", nombre: "L칍GICA I", caracter: "OB. 2췈" }, { codigo: "801309", nombre: "L칍GICA II", caracter: "OB. 2췈" }]
            },
            {
                licenciatura: { codigo: "104441", nombre: "ONTOLOG칈A", caracter: "OB. 1췈" },
                grado: [ { codigo: "801293", nombre: "ONTOLOG칈A FUNDAMENTAL", caracter: "B츼S. 1췈" }, { codigo: "801313", nombre: "HERMEN칄UTICA Y LENGUA", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104442", nombre: "ALEM츼N I", caracter: "OB. 1췈" },
                grado: [ { codigo: "801305", nombre: "ALEM츼N B츼SICO PARA FIL칍SOFOS", caracter: "B츼S. 2췈" }, { codigo: "801294", nombre: "LITERATURA CONTEMPOR츼NEA", caracter: "B츼S. 1췈" }]
            },
            {
                licenciatura: { codigo: "104443", nombre: "LAT칈N I", caracter: "OB. 1췈" },
                grado: [ { codigo: "801305", nombre: "ALEM츼N B츼SICO PARA FIL칍SOFOS", caracter: "B츼S. 2췈" }, { codigo: "801300", nombre: "HISTORIA DEL MUNDO CONTEMPOR츼NEO", caracter: "B츼S. 2췈" }]
            },
            {
                licenciatura: { codigo: "104444", nombre: "GRIEGO I", caracter: "OB. 1췈" },
                grado: [ { codigo: "801305", nombre: "ALEM츼N B츼SICO PARA FIL칍SOFOS", caracter: "B츼S. 2췈" }, { codigo: "801290", nombre: "HISTORIA DEL MUNDO CONTEMPOR츼NEO", caracter: "B츼S. 2췈" }]
            },
            {
                licenciatura: { codigo: "104445", nombre: "HISTORIA FILOSOF칈A MEDIEVAL", caracter: "TR. 1췈" },
                grado: [ { codigo: "801299", nombre: "HISTORIA FILOSOF칈A MEDIEVAL", caracter: "OB. 1췈" }, { codigo: "801320", nombre: "SEM. HISTORIA FILOSOF칈A MEDIEVAL", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104446", nombre: "FILOSOF칈A DEL LENGUAJE", caracter: "TR. 2췈" },
                grado: [ { codigo: "801334", nombre: "FILOSOF칈A DEL LENGUAJE I", caracter: "OB. 3췈" }, { codigo: "801343", nombre: "FILOSOF칈A DEL LENGUAJE II", caracter: "OB. 3췈" }]
            },
            {
                licenciatura: { codigo: "104450", nombre: "FILOSOF칈A NATURALEZA", caracter: "OB. 2췈" },
                grado: [ { codigo: "801303", nombre: "FILOSOF칈A NATURALEZA", caracter: "OB. 2췈" }]
            },
            {
                licenciatura: { codigo: "104447", nombre: "ALEM츼N II", caracter: "OB. 2췈" },
                grado: [ { codigo: "801337", nombre: "ALEM츼N AVANZ. FIL칍SOFOS", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104448", nombre: "LAT칈N II", caracter: "OB. 2췈" },
                grado: [ { codigo: "801338", nombre: "LAT칈N PARA FIL칍SOFOS", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104449", nombre: "GRIEGOII", caracter: "OB. 2췈" },
                grado: [ { codigo: "801339", nombre: "GRIEGO PARA FIL칍SOFOS", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104451", nombre: "TEOR칈A RACIONALIDAD PR츼CTICA", caracter: "OB. 2췈" },
                grado: [ { codigo: "801339G", nombre: "TEOR칈A RACIONALIDAD PR츼CTICA", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104452", nombre: "INTRODUCCI칍N PSICOLOG칈A", caracter: "OB. 2췈" },
                grado: [ { codigo: "801295", nombre: "PSICOLOG칈A B츼SICA", caracter: "B츼S. 1췈" }]
            },
            {
                licenciatura: { codigo: "104453", nombre: "HISTORIA FILOSOF칈A MODERNA", caracter: "TR. 3췈" },
                grado: [ { codigo: "801307", nombre: "HISTORIA FILOSOF칈A MODERNA", caracter: "OB. 2췈" }, { codigo: "801321", nombre: "HISTORIA FILOSOF칈A MODERNA II", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104454", nombre: "칄TICA", caracter: "TR. 3췈" },
                grado: [ { codigo: "801301", nombre: "칄TICA I", caracter: "B츼S. 2췈" }, { codigo: "801308", nombre: "칄TICA II", caracter: "OB. 2췈" }]
            },
            {
                licenciatura: { codigo: "104455", nombre: "TEOR칈A DEL CONOCIMIENTO", caracter: "TR. 3췈" }, // <-- NOMBRE CORREGIDO
                grado: [ { codigo: "801302", nombre: "TEOR칈A CONOCIMIENTO I", caracter: "OB. 2췈" }, { codigo: "801306", nombre: "TEOR칈A CONOCIMIENTO II", caracter: "OB. 2췈" }]
            },
            {
                licenciatura: { codigo: "104456", nombre: "HISTORIA Y FILOSOF칈A DE LA L칍GICA", caracter: "OB. 3췈" },
                grado: [ { codigo: "801313F", nombre: "FILOSOF칈A DE LA L칍GICA", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104457", nombre: "FILOSOF칈A RELIGI칍N", caracter: "OB. 3" },
                grado: [ { codigo: "801315F", nombre: "FILOSOF칈A DE LA RELIGI칍N", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104479", nombre: "METAF칈SICA", caracter: "TR. 4췈" },
                grado: [ { codigo: "801312", nombre: "METAF칈SICA I", caracter: "OB. 3췈" }, { codigo: "801340", nombre: "METAF칈SICA II", caracter: "OB. 3췈" }]
            },
            {
                licenciatura: { codigo: "104480", nombre: "EST칄TICA", caracter: "TR. 4췈" },
                grado: [ { codigo: "801296E", nombre: "EST칄TICA", caracter: "B츼S. 1췈" }, { codigo: "801329", nombre: "PERSP. EST칄TICA CONTEMPOR츼.", caracter: "OB. 3췈" }]
            },
            {
                licenciatura: { codigo: "104481", nombre: "FILOSOF칈A CONTEMPOR츼.", caracter: "OB. 4췈" },
                grado: [ { codigo: "801323S", nombre: "SEM. FILOSOF칈A CONTEMPOR.", caracter: "OPT. 3췈 칩 4췈" }, { codigo: "801322", nombre: "FILOSOF칈A SIGLO XIX", caracter: "OB. 3췈" }]
            },
            {
                licenciatura: { codigo: "104482", nombre: "HISTORIA FILOSOF칈A ESPA칌OLA", caracter: "OB. 4췈" },
                grado: [ { codigo: "801341F", nombre: "FILOSOF칈A ESPA칌OLA CONTEMP.", caracter: "OB. 3췈" }]
            },
            {
                licenciatura: { codigo: "104483", nombre: "HISTORIA TEOR칈A CIENCIA", caracter: "OB. 4췈" },
                grado: [ { codigo: "801336H", nombre: "HISTORIA DE LA CIENCIA", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104484", nombre: "TEOR칈A Y SOCIEDAD", caracter: "OB. 4췈" },
                grado: [ { codigo: "801328T", nombre: "TEOR칈A DE LA SOCIEDAD", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104485", nombre: "ESCUELAS Y SISTEMAS DE PSICOLOG칈A", caracter: "OB. 4췈" }, // <-- NOMBRE CORREGIDO
                grado: [ { codigo: "801344F", nombre: "FILOSOF칈A DE LA MENTE", caracter: "OB. 4췈" }]
            },
            {
                licenciatura: { codigo: "104486", nombre: "FILOSOF칈A CIENCIA", caracter: "TR. 5췈" },
                grado: [ { codigo: "801346", nombre: "FILOSOF칈A DE LA CIENCIA I", caracter: "OB. 4췈" }, { codigo: "801348", nombre: "FILOSOF칈A DE LA CIENCIA II", caracter: "OB. 4췈" }]
            },
            {
                licenciatura: { codigo: "104487", nombre: "FILOSOF칈A POL칈TICA", caracter: "TR. 5췈" },
                grado: [ { codigo: "801291", nombre: "FILOSOF칈A POL칈TICA I", caracter: "B츼S. 1췈" }, { codigo: "801342", nombre: "FILOSOF칈A POL칈TICA II", caracter: "OB. 3췈" }]
            },
            {
                licenciatura: { codigo: "104488", nombre: "CORRIENTES ACTUALES DE LA FILOSOF칈A I", caracter: "TR. 5췈" },
                grado: [ { codigo: "801345C", nombre: "CORRIENTES ACTUALES FILOSOF칈A I", caracter: "OB. 4췈" }]
            },
            {
                licenciatura: { codigo: "104489", nombre: "CORRIENTES ACTUALES DE LA FILOSOF칈A II", caracter: "TR. 5췈" },
                grado: [ { codigo: "801347C", nombre: "CORRIENTES ACTUALES FILOSOF칈A II", caracter: "OB. 4췈" }]
            },
            {
                licenciatura: { codigo: "104490", nombre: "FILOSOF칈A DE LA ACCI칍N", caracter: "TR. 5췈" },
                grado: [ { codigo: "801310F", nombre: "FILOSOF칈A DE LA ACCI칍N", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104491", nombre: "FILOSOF칈A DE LA HISTORIA", caracter: "OB. 5췈" },
                grado: [ { codigo: "801318F", nombre: "FILOSOF칈A DE LA HISTORIA", caracter: "OPT. 3췈 칩 4췈" }]
            },
            {
                licenciatura: { codigo: "104498", nombre: "TEOR칈AS DE LA LIBERTAD", caracter: "2췈" },
                grado: [ { codigo: "801314", nombre: "TEOR칈AS DE LA LIBERTAD", caracter: "" }]
            },
            {
                licenciatura: { codigo: "U 07", nombre: "CIENCIA, TECNOLOG칈A Y SOCIEDAD", caracter: "GEN칄RICA" },
                grado: [ { codigo: "801327C", nombre: "CIENCIA, TECNOLOG칈A Y SOCIEDAD", caracter: "" }]
            },
            {
                licenciatura: { codigo: "104469F", nombre: "TEOR칈A Y CR칈TICA FEMINISTA", caracter: "1췈" },
                grado: [ { codigo: "801332", nombre: "TEOR칈A Y CR칈TICA FEMINISTA", caracter: "" }]
            }
        ];

        // --- VARIABLES DE ESTADO Y ELEMENTOS DOM ---
        let filteredLicenciaturaSubjects = [...adaptationData];
        let selectedLicenciaturaCodes = []; // Almacena los c칩digos de las asignaturas de Lic. seleccionadas

        const searchInput = document.getElementById('search-input');
        const subjectListEl = document.getElementById('subject-list');
        const resultsSectionEl = document.getElementById('results-section');
        const equivalencesContainerEl = document.getElementById('equivalences-container');
        const noSelectedSubjectsEl = document.getElementById('no-selected-subjects');
        const summaryTextEl = document.getElementById('summary-text');
        const noResultsEl = document.getElementById('no-results');
        const clearSelectedButton = document.getElementById('clear-selected-button');

        // --- FUNCIONES AUXILIARES ---
        function normalizeText(text) {
            if (!text) return "";
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        }

        // --- L칍GICA DE RENDERIZADO ---
        function renderLicenciaturaSubjectList() {
            if (!subjectListEl) return;

            if (filteredLicenciaturaSubjects.length === 0 && searchInput.value.trim() !== "") {
                subjectListEl.style.display = 'none';
                noResultsEl.style.display = 'block';
                return;
            }

            noResultsEl.style.display = 'none';
            subjectListEl.style.display = 'block';
            subjectListEl.innerHTML = filteredLicenciaturaSubjects.map(item => {
                const isSelected = selectedLicenciaturaCodes.includes(item.licenciatura.codigo);
                return `
                <div class="subject-item ${isSelected ? 'selected-for-adaptation' : ''}" 
                     onclick="toggleLicenciaturaSelection('${item.licenciatura.codigo}')"
                     data-codigo="${item.licenciatura.codigo}">
                    <span class="subject-name">${item.licenciatura.nombre}</span>
                    <span class="subject-code">C칩d: ${item.licenciatura.codigo} (${item.licenciatura.caracter})</span>
                </div>
            `}).join('');
        }

        function renderResults() {
            if (!equivalencesContainerEl || !summaryTextEl || !resultsSectionEl || !noSelectedSubjectsEl) return;

            if (selectedLicenciaturaCodes.length === 0) {
                resultsSectionEl.style.display = 'none'; // Ocultar toda la secci칩n de resultados
                return;
            }
            
            resultsSectionEl.style.display = 'block'; // Mostrar la secci칩n de resultados
            equivalencesContainerEl.innerHTML = ''; // Limpiar resultados anteriores
            let allGradoEquivalents = [];

            if (selectedLicenciaturaCodes.length > 0) {
                noSelectedSubjectsEl.style.display = 'none';
                selectedLicenciaturaCodes.forEach(codigoLic => {
                    const subjectData = adaptationData.find(item => item.licenciatura.codigo === codigoLic);
                    if (subjectData) {
                        const block = document.createElement('div');
                        block.className = 'licenciatura-block';
                        block.innerHTML = `<h3>${subjectData.licenciatura.nombre} (Licenciatura) equivale a:</h3>`;
                        
                        subjectData.grado.forEach((gradoItem, index) => {
                            block.innerHTML += `
                                <div class="equivalence-card">
                                    <div class="equivalence-type">Equivalencia en Grado ${subjectData.grado.length > 1 ? (index + 1) : ''}</div>
                                    <div class="equivalence-content">
                                        <h4>${gradoItem.nombre || 'Nombre no disponible'}</h4>
                                        <div class="equivalence-details">
                                            <span class="code-badge">C칩d: ${gradoItem.codigo || 'N/A'}</span>
                                            <span class="character-badge">${gradoItem.caracter || 'Car치cter no especificado'}</span>
                                        </div>
                                    </div>
                                </div>`;
                            allGradoEquivalents.push(gradoItem);
                        });
                        equivalencesContainerEl.appendChild(block);
                    }
                });
            } else {
                noSelectedSubjectsEl.style.display = 'block';
            }


            // Renderizar resumen general
            if (allGradoEquivalents.length > 0) {
                // Evitar duplicados en el resumen general
                const uniqueGradoEquivalents = allGradoEquivalents.filter((grado, index, self) =>
                    index === self.findIndex((g) => (
                        g.codigo === grado.codigo
                    ))
                );

                let summary = `<p>Con las asignaturas de Licenciatura seleccionadas, se te reconocer칤an las siguientes asignaturas del nuevo Grado en Filosof칤a:</p><ul>`;
                uniqueGradoEquivalents.forEach(g => {
                    summary += `<li><strong>${g.nombre || 'Asignatura sin nombre especificado'}</strong> (C칩d: ${g.codigo || 'N/A'}, ${g.caracter || 'Car치cter no especificado'})</li>`;
                });
                summary += `</ul><p>Este es el conjunto total de asignaturas de Grado que tendr칤as aprobadas.</p>`;
                summaryTextEl.innerHTML = summary;
            } else {
                summaryTextEl.innerHTML = `<p>A칰n no has seleccionado asignaturas de Licenciatura o las seleccionadas no tienen equivalencias directas definidas.</p>`;
            }
        }


        // --- MANEJADORES DE EVENTOS Y L칍GICA DE INTERACCI칍N ---
        function filterLicenciaturaSubjects(searchTerm) {
            const normalizedSearchTerm = normalizeText(searchTerm);
            if (!normalizedSearchTerm.trim()) {
                filteredLicenciaturaSubjects = [...adaptationData];
            } else {
                filteredLicenciaturaSubjects = adaptationData.filter(item =>
                    normalizeText(item.licenciatura.nombre).includes(normalizedSearchTerm) ||
                    item.licenciatura.codigo.toString().toLowerCase().includes(normalizedSearchTerm) // C칩digo no suele tener acentos
                );
            }
            renderLicenciaturaSubjectList();
        }

        function toggleLicenciaturaSelection(codigoLic) {
            const index = selectedLicenciaturaCodes.indexOf(codigoLic);
            if (index > -1) {
                selectedLicenciaturaCodes.splice(index, 1); // Deseleccionar
            } else {
                selectedLicenciaturaCodes.push(codigoLic); // Seleccionar
            }
            
            // Actualizar visualmente el item en la lista de b칰squeda
            const listItem = subjectListEl.querySelector(`.subject-item[data-codigo="${codigoLic}"]`);
            if(listItem) {
                listItem.classList.toggle('selected-for-adaptation');
            }

            renderResults(); // Actualizar la secci칩n de resultados
        }
        
        function clearAllSelections() {
            selectedLicenciaturaCodes = [];
            searchInput.value = ''; // Limpiar campo de b칰squeda
            filterLicenciaturaSubjects(''); // Mostrar todas las asignaturas de licenciatura de nuevo
            renderResults(); // Esto ocultar치 la secci칩n de resultados porque no hay nada seleccionado
        }


        // --- INICIALIZACI칍N ---
        document.addEventListener('DOMContentLoaded', () => {
            if (searchInput) {
                searchInput.addEventListener('input', (e) => filterLicenciaturaSubjects(e.target.value));
            }
            if (clearSelectedButton) {
                clearSelectedButton.addEventListener('click', clearAllSelections);
            }

            // Corregir nombres en adaptationData ANTES del primer renderizado
            adaptationData.forEach(item => {
                if (item.licenciatura.codigo === "104455") item.licenciatura.nombre = "TEOR칈A DEL CONOCIMIENTO";
                if (item.licenciatura.codigo === "104485") item.licenciatura.nombre = "ESCUELAS Y SISTEMAS DE PSICOLOG칈A";
            });
            
            filteredLicenciaturaSubjects = [...adaptationData]; // Asegurar que filteredData se inicializa con los nombres corregidos
            renderLicenciaturaSubjectList(); // Renderizar lista inicial de asignaturas de Lic.
            renderResults(); // Renderizar (ocultar) secci칩n de resultados inicial
        });

    </script>
</body>
</html>